# Http请求报文结构
使用正则和状态机来解析HTTP请求报文，首先需要理解HTTP请求报文的基本结构。一个典型的HTTP请求报文如下：
```
GET /index.html HTTP/1.1
Host: www.example.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Encoding: gzip, deflate, sdch, br
Accept-Language: en-US,en;q=0.8
```
&emsp;HTTP请求报文由**请求行、请求头部和请求体**组成。
- 请求行包括请求方法、请求的资源路径和HTTP协议版本。
- 请求头部包含多个键值对，用于描述请求的各种属性。
- 请求体通常用于POST或PUT请求，包含发送给服务器的数据。

# 状态机
下面是一个简单的状态机来解析HTTP请求报文：
1. 初始状态：等待请求行
2. 读取请求行：使用正则表达式匹配请求行，获取请求方法、资源路径和HTTP协议版本。然后将状态机转移到请求头部解析状态。
3. 读取请求头部：逐行读取数据，使用正则表达式匹配键值对。当遇到空行时，表示请求头部结束，将状态机转移到请求体解析状态。
4. 读取请求体：对于POST或PUT请求，需要解析请求体。请求体的长度通常在请求头部的Content-Length字段中指定。使用正则表达式或其他方法按长度读取请求体数据。解析完请求体后，状态机回到初始状态，等待下一个请求。

# 状态转移过程
状态转移是指在状态机中，**根据当前状态和输入事件，将状态机从当前状态转移到另一个状态的过程**。在解析HTTP请求报文的状态机中，状态转移的过程如下：

1. **初始状态（等待请求行）：**
    - 当状态机刚创建时，它处于初始状态，准备接收HTTP请求报文。
    - 在这个状态下，状态机期待接收请求行，这是HTTP请求报文的开始部分。
2. **读取请求行：**
    - 当状态机接收到数据时，它首先尝试匹配请求行的正则表达式。
    - 如果成功匹配，状态机获取请求方法、资源路径和HTTP协议版本，并将状态转移到请求头部解析状态。
    - 如果数据不足以匹配请求行，状态机将等待更多的数据。
3. **读取请求头部：**
    - 在请求头部解析状态下，状态机逐行读取数据，期待每行都是一个键值对。
    - 每读取一行，它使用正则表达式匹配键值对，并将键值对添加到请求头部字典中。
    - 当遇到空行时，表示请求头部结束，状态机将状态转移到请求体解析状态。
4. **读取请求体：**
    - 在请求体解析状态下，状态机根据请求头部中的Content-Length字段来确定请求体的长度。
    - 如果请求体存在（例如，对于POST或PUT请求），状态机将读取指定长度的数据作为请求体。
    - 一旦请求体读取完毕，状态机将重置为初始状态，准备接收下一个HTTP请求报文。

> 在整个状态转移过程中，状态机根据当前状态和接收到的输入数据来决定下一步的动作。每个状态都对应着一组可能的输入和一组可能的状态转移。状态机的设计需要确保它能够处理所有有效的输入序列，并且对于无效的输入能够适当地做出响应（例如，通过报告错误或忽略无效数据）。

> 在实现状态机时，通常使用条件语句（如if/else或switch/case）来根据当前状态和输入事件选择下一个状态。此外，状态机还可以包含其他逻辑，如数据验证、错误处理和日志记录等，以确保解析过程的正确性和健壮性。